<!DOCTYPE html>
<html>
<head>
	<title>d3.js with leaflet.js</title>

    
    <script src="http://d3js.org/d3.v4.min.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css"/>
    <!--Customized CSS-->
    <style>
    .hull {
        fill: steelblue;
        stroke: steelblue;
        stroke-width: 32px;
        stroke-linejoin: round;
    }
    </style>
    
</head>
<body>
	<div id="map" style="width: 1200px; height: 768px"></div>
	<script type="text/javascript">
        var map = L.map('map').setView([42.877742, -97.380979], 4);
        mapLink = '<a href="http://openstreetmap.org">OpenStreetMap</a>';
        L.tileLayer(
            'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; ' + mapLink + ' Contributors',
            maxZoom: 18,
            }).addTo(map);
	    map._initPathRoot()

        // Sales reps locations
        var reps = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "name": "Rep 1",
        "marker-color": "#0000ff",
        "marker-symbol": "rail-metro",
        "line": "blue"
      },
      
      "geometry": {
        "type": "Point",
        "coordinates": [26.34275055, -81.31328583]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "name": "Rep 2",
        "marker-color": "#0000ff",
        "marker-symbol": "rail-metro",
        "line": "blue"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [39.530895, -119.814972]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "name": "Rep 3",
        "marker-color": "#0000ff",
        "marker-symbol": "rail-metro",
        "line": "blue"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [39.95080566,-105.1594925]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Rep 4",
        "marker-color": "#ff0000",
        "marker-symbol": "rail-metro",
        "line": "red"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [42.51844406,-87.9826355]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Rep 5",
        "marker-color": "#0000ff",
        "marker-symbol": "rail-metro",
        "line": "blue"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [28.2949, -80.666]
      }
    }
    /*
    -78.78852844	35.76341248
-73.31693268	40.86263275
-92.19317627	29.89461136
-97.14483643	32.57073975
-87.9506073	42.29540634
-116.4317551	43.64958572
-70.82943726	42.97993469
-71.17945862	42.24687195

    */
  ]
};	

	/* We simply pick up the SVG from the map object */
	var svg = d3.select("#map").select("svg"),
	g = svg.append("g");

    /* Add a LatLng object to each item in the dataset */
    var p=[]
    reps.features.forEach(function(d) {
        d.LatLng = new L.LatLng(d.geometry.coordinates[0],
                                d.geometry.coordinates[1]);
        p.push([d.geometry.coordinates[0],d.geometry.coordinates[1]]);
    })

    var states = [{
    "type": "Feature",
    "properties": {"party": "Republican"},
    "geometry": {
        "type": "Polygon",
        "coordinates": [p]
    }
}, {
    "type": "Feature",
    "properties": {"party": "Democrat"},
    "geometry": {
        "type": "Polygon",
        "coordinates": [[
            [-109.05, 41.00],
            [-102.06, 40.99],
            [-102.03, 36.99],
            [-109.04, 36.99],
            [-109.05, 41.00]
        ]]
    }
}];
    console.log(p)
    console.log(states)
    var feature = g.selectAll("circle")
        .data(reps.features)
        .enter()
        .append("circle")
        .attr("class", "dot")
        .style("opacity", .6) 
        .style("fill", "red")
        .attr("r", 5);

    function projectPoint(x, y) {
        var point = map.latLngToLayerPoint(new L.LatLng(x, y));
        this.stream.point(point.x, point.y);
    }

    var transform = d3.geoTransform({point: projectPoint});
    var path = d3.geoPath().projection(transform);

    var featureHull =  svg.selectAll("path")
        .data(d3.polygonHull(reps.features))
        .enter()
        .append("path")
        .attr("stroke", "gray")
        .attr("fill", "green")
        .attr("fill-opacity", 0.6)

    setInterval(transition, 750)
    map.on("viewreset", update);
    featureHull.attr("d", path)
    update();

    // Add polygon to map
    var polygon = L.polygon(d3.polygonHull(p)).addTo(map);
    // Using geo json to draw polygon 
    //var polygon =L.geoJson(states).addTo(map);

    function pointsToPolygon(){
        console.log(d3.polygonHull(reps.features));
        svg.append("path")
            .attr("fill", "red")
            .attr("d", d3.geoPath(d3.polygonHull(feature)));
    }
    function update() {
        feature.attr("transform", function(d) { 
            return "translate("+ 
                map.latLngToLayerPoint(d.LatLng).x +","+ 
                map.latLngToLayerPoint(d.LatLng).y +")";
        });
        featureHull.attr("d", path)

    }
    function transition(){
        svg
        .selectAll("ring")
        .data(reps.features)
        .enter()
        .append("circle")
        // Using filter to select a specific element
        .filter(function(d,i){return i===2;})
            .attr("class", "ring")
            .attr("transform", function(d) { 
                return "translate("+ 
                    map.latLngToLayerPoint(d.LatLng).x +","+ 
                    map.latLngToLayerPoint(d.LatLng).y +")";})
            .attr("r", 6)
            .style("stroke-width", 1)
            .style("stroke", "red")
            .style("fill", "none")
        .transition()
            .ease(d3.easeLinear)
            .duration(2000) // Change Speed
            .style("stroke-opacity", 1e-6)
            .style("stroke-width", 1)
            .style("stroke", "red")
            .attr("r", 30)
            .remove();
    }


</script>
</body>
</html>