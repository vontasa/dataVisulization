<!DOCTYPE html>
<html>
<head>
	<title>d3.js with leaflet.js</title>

    
    <script src="http://d3js.org/d3.v4.min.js"></script>

    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css"/>
    <!--Customized CSS-->
    <style>
    .hull {
        fill: steelblue;
        stroke: steelblue;
        stroke-width: 16px;
        stroke-linejoin: round;
        opacity: 0.5
    }
    .group.a { fill: #FF5252; stroke: #FF5252;stroke-width: 16px;stroke-linejoin: round;opacity: 0.5}
    .group.b { fill: #673AB7; stroke: #673AB7;stroke-width: 16px;stroke-linejoin: round;opacity: 0.5}
    .group.c { fill: #42A5F5; stroke: #42A5F5;stroke-width: 16px;stroke-linejoin: round;opacity: 0.5}
    .group.d { fill: #009688; stroke: #009688;stroke-width: 16px;stroke-linejoin: round;opacity: 0.5}
    .group.e { fill: #C0CA33; stroke: #C0CA33;stroke-width: 16px;stroke-linejoin: round;opacity: 0.5}

    .place-label {
        fill: black;
        fill-opacity: .8;
        font-size: 20px;
        font-weight: 300;
        text-anchor: middle;
    }

    .container {
      width: 100px;
      margin: 0 auto;
    }

    .button {
        padding: 0;
        width: 100px;
        height: 100px;
        border: 0;
        background-color: white;
        outline: none;
    }
    </style>
</head>
<body>
    <div id="Panel">
        <h1>Territory Allocation Demo</h1>
        
        <button id="pre" type="button" onclick="previous()">Previous</button>
        
        <button id="play" class="button js-button">
            <svg viewBox="0 0 36 36" >
                <defs>
                    <path id="pause-icon" data-state="playing" d="M11,10 L17,10 17,26 11,26 M20,10 L26,10 26,26 20,26" />
                    <path id="play-icon"  data-state="paused"  d="M11,10 L18,13.74 18,22.28 11,26 M18,13.74 L26,18 26,18 18,22.28" />
                </defs>
                <use xlink:href="#play-icon" />
            </svg>
        </button>


    </div>
	<div id="map" style="width: 1024px; height: 600px"></div>
	<script type="text/javascript">
    var playButton = {
        el: document.querySelector(".js-button"),
        states: {
            playing: {
                nextState: "paused",
                iconEl: document.querySelector("#pause-icon")
            },
            paused:  {
                nextState: "playing",
                iconEl: document.querySelector("#play-icon")
            }
        },

        animationDuration: 350,

        init: function () {
            this.setInitialState();
            this.replaceUseEl();
            this.el.addEventListener("click", this.goToNextState.bind(this));
        },

        setInitialState: function () {
          var initialIconRef = this.el.querySelector("use").getAttribute("xlink:href");
          var stateName = this.el.querySelector(initialIconRef).getAttribute("data-state");
          this.setState(stateName);
        },

        replaceUseEl: function () {
            d3.select(this.el.querySelector("use")).remove();
            d3.select(this.el.querySelector("svg")).append("path")
                .attr("class", "js-icon")
                .attr("d", this.stateIconPath());
        },

        goToNextState: function () {
            this.setState(this.state.nextState);

            d3.select(this.el.querySelector(".js-icon")).transition()
                .duration(this.animationDuration)
                .attr("d", this.stateIconPath());
        },

        setState: function (stateName) {
            this.state = this.states[stateName];
        },

        stateIconPath: function () {
            return this.state.iconEl.getAttribute("d");
        }
    };

    playButton.init();
    var map = L.map('map').setView([42.877742, -97.380979], 4);
    mapLink = '<a href="http://openstreetmap.org">OpenStreetMap</a>';
    L.tileLayer(
        'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; ' + mapLink + ' Contributors',
        maxZoom: 18,
        }).addTo(map);
    L.svg({clickable:true}).addTo(map);	

    // Sales reps locations

var reps = {
                  "type": "FeatureCollection",
                  "features": [
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "ArmstrongPhillip",
                              "group": "BlankenshipGregory",
                              "salesdollars": 2567772,
                              "accounts": 197,
                              "territoryscore": 56.30091627
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-80.666, 28.2949]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "AvelinoJessica",
                              "group": "BlankenshipGregory",
                              "salesdollars": 2286020,
                              "accounts": 116,
                              "territoryscore": 50.58986263
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-81.31328583, 26.34275055]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "BartkowskiTara",
                              "group": "SchecterChristopher",
                              "salesdollars": 4118827,
                              "accounts": 64,
                              "territoryscore": 72.5769115
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-119.814972, 39.530895]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "BeckerAmy",
                              "group": "SchecterChristopher",
                              "salesdollars": 6447900,
                              "accounts": 68,
                              "territoryscore": 72.76447748
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-105.1594925, 39.95080566]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "BoehmTamara",
                              "group": "Mueller-SparacinoKaren",
                              "salesdollars": 4562424,
                              "accounts": 59,
                              "territoryscore": 65.60889806
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-87.9826355, 42.51844406]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "BovaJustin",
                              "group": "Mueller-SparacinoKaren",
                              "salesdollars": 3673049,
                              "accounts": 69,
                              "territoryscore": 69.24858755
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-78.78852844, 35.76341248]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "CapodacquaFrank",
                              "group": "DugganCaitlin",
                              "salesdollars": 3739405,
                              "accounts": 75,
                              "territoryscore": 74.64630247
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-73.31693268, 40.86263275]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "CastroJason",
                              "group": "FarrellDaniel",
                              "salesdollars": 11196634,
                              "accounts": 75,
                              "territoryscore": 68.63286506
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-92.19317627, 29.89461136]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "ChambersKelli",
                              "group": "FarrellDaniel",
                              "salesdollars": 8690234,
                              "accounts": 67,
                              "territoryscore": 73.27719771
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-97.14483643, 32.57073975]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "ClawsonDebra",
                              "group": "Mueller-SparacinoKaren",
                              "salesdollars": 3404601,
                              "accounts": 55,
                              "territoryscore": 69.4255041
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-87.9506073, 42.29540634]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "ClaytonReed",
                              "group": "SchecterChristopher",
                              "salesdollars": 3246446,
                              "accounts": 72,
                              "territoryscore": 70.94007343
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-116.4317551, 43.64958572]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "DalyJames",
                              "group": "DugganCaitlin",
                              "salesdollars": 3338967,
                              "accounts": 51,
                              "territoryscore": 55.47342752
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-70.82943726, 42.97993469]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "DeWitJohn",
                              "group": "DugganCaitlin",
                              "salesdollars": 4502147,
                              "accounts": 81,
                              "territoryscore": 72.6095952
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-71.17945862, 42.24687195]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "DuhonJamie",
                              "group": "Greta",
                              "salesdollars": 5019460,
                              "accounts": 22,
                              "territoryscore": 50.95838556
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-97.49967957, 37.62818527]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "EwaskowitzJennifer",
                              "group": "Greta",
                              "salesdollars": 10983435,
                              "accounts": 157,
                              "territoryscore": 93.13152749
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-93.49703217, 45.10640335]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "FrederickGwendolyn",
                              "group": "DugganCaitlin",
                              "salesdollars": 3303680,
                              "accounts": 107,
                              "territoryscore": 69.14729132
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-76.61489868, 39.36856079]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "FullerJoyceAnn",
                              "group": "z???Keith",
                              "salesdollars": 7313172,
                              "accounts": 127,
                              "territoryscore": 82.85952186
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-84.65267944, 39.41363144]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "GallagherKevin",
                              "group": "SchecterChristopher",
                              "salesdollars": 7661233,
                              "accounts": 124,
                              "territoryscore": 95.46302756
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-122.5367584, 45.41352463]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "GravesAdam",
                              "group": "z???Keith",
                              "salesdollars": 3913131,
                              "accounts": 62,
                              "territoryscore": 79.06657118
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-90.29172516, 38.6104126]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "GregoryDenise",
                              "group": "Greta",
                              "salesdollars": 5128345,
                              "accounts": 55,
                              "territoryscore": 68.44956854
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-94.52323151, 39.11434555]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "HahnGeoffrey",
                              "group": "Mueller-SparacinoKaren",
                              "salesdollars": 3834180,
                              "accounts": 101,
                              "territoryscore": 80.43884042
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-88.02632904, 42.1314621]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "HaleJulian",
                              "group": "SooleyMichael",
                              "salesdollars": 3990968,
                              "accounts": 83,
                              "territoryscore": 77.82975368
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-120.4335098, 34.83179092]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "HamerlinckAndrew",
                              "group": "BaxGail",
                              "salesdollars": 4153025,
                              "accounts": 27,
                              "territoryscore": 61.32317989
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-93.0942688, 34.44923782]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "HansenEric",
                              "group": "FarrellDaniel",
                              "salesdollars": 6542938,
                              "accounts": 75,
                              "territoryscore": 77.68766417
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-97.8380127, 30.0785141]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "HeerdegenKeith",
                              "group": "SooleyMichael",
                              "salesdollars": 6916344,
                              "accounts": 92,
                              "territoryscore": 76.80408885
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-112.0484161, 33.62723923]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "HendersonEric",
                              "group": "SooleyMichael",
                              "salesdollars": 6296733,
                              "accounts": 96,
                              "territoryscore": 85.14199037
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-111.741806, 33.30324173]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "HudsonRichard",
                              "group": "FarrellDaniel",
                              "salesdollars": 10059823,
                              "accounts": 53,
                              "territoryscore": 72.09918334
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-95.52352905, 29.52903748]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "IbeleCaley",
                              "group": "FarrellDaniel",
                              "salesdollars": 6592120,
                              "accounts": 74,
                              "territoryscore": 78.37778186
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-95.41107941, 29.77154541]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "JacksonKenneth",
                              "group": "SooleyMichael",
                              "salesdollars": 2154821,
                              "accounts": 71,
                              "territoryscore": 68.8768094
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-122.2691574, 37.80876541]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "KungMonica",
                              "group": "SooleyMichael",
                              "salesdollars": 3969139,
                              "accounts": 121,
                              "territoryscore": 85.14632353
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-118.4021301, 33.88915253]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "LanhamDendra",
                              "group": "z???Keith",
                              "salesdollars": 4827786,
                              "accounts": 49,
                              "territoryscore": 71.18241579
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-89.94350433, 35.11051941]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "LeTrisha",
                              "group": "FarrellDaniel",
                              "salesdollars": 11951040,
                              "accounts": 36,
                              "territoryscore": 84.39887725
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-97.14483643, 32.57073975]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "MerchantSally",
                              "group": "DugganCaitlin",
                              "salesdollars": 5884689,
                              "accounts": 101,
                              "territoryscore": 75.78209917
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-74.16884613, 40.9990921]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "MillerBrandon",
                              "group": "SooleyMichael",
                              "salesdollars": 4595193,
                              "accounts": 101,
                              "territoryscore": 89.65945954
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-117.0190353, 32.98360443]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "MonkMaennerElizabeth",
                              "group": "BlankenshipGregory",
                              "salesdollars": 3734497,
                              "accounts": 184,
                              "territoryscore": 84.11466703
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-82.72437286, 28.03306007]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "MorgensternCathy",
                              "group": "BaxGail",
                              "salesdollars": 8509396,
                              "accounts": 48,
                              "territoryscore": 79.60568088
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-95.94669342, 36.12694168]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "NoorbeheshtKim",
                              "group": "BlankenshipGregory",
                              "salesdollars": 3763020,
                              "accounts": 205,
                              "territoryscore": 87.50268282
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-84.46218872, 33.93427658]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "O'NeillErica",
                              "group": "SchecterChristopher",
                              "salesdollars": 3303804,
                              "accounts": 62,
                              "territoryscore": 68.87613943
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-115.1576157, 35.99584579]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "ProffittHelen",
                              "group": "BlankenshipGregory",
                              "salesdollars": 4768615,
                              "accounts": 103,
                              "territoryscore": 73.47519036
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-81.26218414, 31.85149574]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "PuckettJason",
                              "group": "BaxGail",
                              "salesdollars": 4456182,
                              "accounts": 145,
                              "territoryscore": 81.45784607
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-86.74446106, 33.50667191]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "PuterbaughAdam",
                              "group": "Mueller-SparacinoKaren",
                              "salesdollars": 5944870,
                              "accounts": 156,
                              "territoryscore": 89.35945606
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-83.01509857, 40.01981354]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "RandallKurt",
                              "group": "Greta",
                              "salesdollars": 11726767,
                              "accounts": 66,
                              "territoryscore": 77.3526831
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-95.99661255, 41.36741257]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "RandolphWilliam",
                              "group": "BlankenshipGregory",
                              "salesdollars": 3275067,
                              "accounts": 197,
                              "territoryscore": 84.40730216
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-80.85668182, 35.13050842]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "RehwinkelJohn",
                              "group": "SchecterChristopher",
                              "salesdollars": 4457201,
                              "accounts": 45,
                              "territoryscore": 59.93311542
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-105.1047974, 39.77267456]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "RiekerMichael",
                              "group": "DugganCaitlin",
                              "salesdollars": 5991165,
                              "accounts": 63,
                              "territoryscore": 67.42406536
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-75.5042572, 40.65742874]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "SavageCornelius",
                              "group": "BlankenshipGregory",
                              "salesdollars": 1603641,
                              "accounts": 112,
                              "territoryscore": 50.39764491
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-81.72123718, 30.29880524]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "ScardinoLauren",
                              "group": "DugganCaitlin",
                              "salesdollars": 7024331,
                              "accounts": 33,
                              "territoryscore": 67.63482639
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-75.36842346, 40.32630539]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "SchickJason",
                              "group": "SchecterChristopher",
                              "salesdollars": 3865869,
                              "accounts": 156,
                              "territoryscore": 78.93673664
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-122.1443634, 47.61382675]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "SchmoyerKim",
                              "group": "Mueller-SparacinoKaren",
                              "salesdollars": 3597819,
                              "accounts": 56,
                              "territoryscore": 81.68903123
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-78.84619904, 42.97345352]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "SeelyeMarielle",
                              "group": "Greta",
                              "salesdollars": 5789763,
                              "accounts": 66,
                              "territoryscore": 66.11148704
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-85.11815643, 44.0952034]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "ShervinJustine",
                              "group": "DugganCaitlin",
                              "salesdollars": 2982649,
                              "accounts": 53,
                              "territoryscore": 68.56905571
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-74.83726501, 40.18046951]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "SmiddyTeresa",
                              "group": "FarrellDaniel",
                              "salesdollars": 11241564,
                              "accounts": 100,
                              "territoryscore": 74.22505671
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-97.09350586, 32.62189484]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "StahlPeter",
                              "group": "SooleyMichael",
                              "salesdollars": 3327784,
                              "accounts": 65,
                              "territoryscore": 79.6352317
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-122.4224472, 37.79538727]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "TaylorCraig",
                              "group": "FarrellDaniel",
                              "salesdollars": 4839624,
                              "accounts": 81,
                              "territoryscore": 75.62376738
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-90.99700165, 30.20655632]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "TharpSusanne",
                              "group": "FarrellDaniel",
                              "salesdollars": 5551974,
                              "accounts": 68,
                              "territoryscore": 83.40133906
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-95.52902222, 30.04044724]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "TrujilloMario",
                              "group": "BlankenshipGregory",
                              "salesdollars": 8470187,
                              "accounts": 173,
                              "territoryscore": 91.61432969
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-86.80125427, 36.1338768]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "VictorioShellie",
                              "group": "BlankenshipGregory",
                              "salesdollars": 5233898,
                              "accounts": 199,
                              "territoryscore": 81.54387107
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-80.13182831, 25.88333702]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "WallinJMonty",
                              "group": "BaxGail",
                              "salesdollars": 13383633,
                              "accounts": 51,
                              "territoryscore": 85.64792329
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-97.484375, 35.61878967]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "WebbBenjamin",
                              "group": "z???Keith",
                              "salesdollars": 5941565,
                              "accounts": 79,
                              "territoryscore": 68.2994255
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-86.17475891, 39.96260452]
                            }
                        },
                          {
                            "type": "Feature",  
                            "properties": { 
                              "name": "WoldLisa",
                              "group": "Mueller-SparacinoKaren",
                              "salesdollars": 3172708,
                              "accounts": 98,
                              "territoryscore": 68.92161474
                            },
                            "geometry": {
                              "type": "Point",
                              "coordinates": [-83.33808899, 42.61193466]
                            }
                        },
                  ]
                 };
    /*var reps = {
    "type": "FeatureCollection",
    
    "features": [
    {
      "type": "Feature",
      "properties": {
        "name": "Rep 1",
        "group": "a",
        "score":100,
      },
      "geometry": {
        "type": "Point",
        "coordinates": [26.34275055, -81.31328583]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "name": "Rep 2",
        "group": "a",
        "score":100,
      },
      "geometry": {
        "type": "Point",
        "coordinates": [39.530895, -119.814972]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "name": "Rep 3",
        "group": "a",
        "score":100,
      },
      "geometry": {
        "type": "Point",
        "coordinates": [42.51844406, -87.9826355]
      }
    },
 
    {
      "type": "Feature",
      "properties": {
        "name": "Rep 4",
        "group": "a",
        "score":100,
      },
      "geometry": {
        "type": "Point",
        "coordinates": [39.95080566, -105.1594925]
      }
    },
  
    {
      "type": "Feature",
      "properties": {
        "name": "Rep 5",
        "group": "a",
        "score":100,
      },
      "geometry": {
        "type": "Point",
        "coordinates": [28.2949, -80.666]
      }
    },
    
    {
      "type": "Feature",
      "properties": {
        "name": "Rep 6",
        "group": "b",
        "score":100,
      },
      "geometry": {
        "type": "Point",
        "coordinates": [35.76341248, -78.78852844]
      }
    },
    
    {
      "type": "Feature",
      "properties": {
        "name": "Rep 7",
        "group": "b",
        "score":100,
      },
      "geometry": {
        "type": "Point",
        "coordinates": [40.86263275, -73.31693268]
      }
    },
    
    {
      "type": "Feature",
      "properties": {
        "name": "Rep 8",
        "group": "b",
        "score":100,
      },
      "geometry": {
        "type": "Point",
        "coordinates": [29.89461136, -92.19317627]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Rep 9",
        "group": "b",
        "score":100,
      },
      "geometry": {
        "type": "Point",
        "coordinates": [32.57073975, -97.14483643]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Rep 10",
        "group": "b",
        "score":100,
      },
      "geometry": {
        "type": "Point",
        "coordinates": [42.29540634, -87.9506073]
      }
    },

  ]
};	*/



	/* We simply pick up the SVG from the map object */
	var svg = d3.select("#map").select("svg")
    .attr("pointer-events", "auto");
	g = svg.append("g");

    /* Add a LatLng object to each item in the dataset */
  var p=[]
  reps.features.forEach(function(d) {
      d.LatLng = new L.LatLng(d.geometry.coordinates[0],
                              d.geometry.coordinates[1]);
      p.push([d.geometry.coordinates[0],d.geometry.coordinates[1]]);
  })



  var states = [  
    {
      "type": "Feature",
      "properties": {"id":"BlankenshipGregory"},
      "geometry": {
          "type": "Polygon",
          "coordinates": [],
          "points":[]
      }
  },

  {
      "type": "Feature",
      "properties": {"id":"Mueller-SparacinoKaren"},
      "geometry": {
          "type": "Polygon",
          "coordinates": [],
          "points":[]
      }
  }
];

    var story = [
        {"point":0, "from":"a", "to":"b"},
        {"point":9, "from":"b", "to":"a"},
        {"point":8, "from":"b", "to":"a"},
        {"point":0, "from":"b", "to":"a"},
        {"point":9, "from":"a", "to":"b"},
        {"point":8, "from":"a", "to":"b"},
    ];
    function getHull(){
        // Clean all points in states
        states.forEach(function(e){e.geometry.points=[];});
        // Assign poitns
        reps.features.forEach(function(d) {
            var target = states.find(function(g){
                return g.properties.id===d.properties.group
            })
            target.geometry.points.push([d.geometry.coordinates[0],d.geometry.coordinates[1]]);
        })
        //Calculate hull
        states.forEach(function(e){
            var hull =  d3.polygonHull(e.geometry.points);
            hull.push([]);
            e.geometry.coordinates = [hull];});
    }
    

    function projectPoint(x, y) {
        var point = map.latLngToLayerPoint(new L.LatLng(x, y));
        this.stream.point(point.x, point.y);
    }

    var transform = d3.geoTransform({point: projectPoint});
    var path = d3.geoPath().projection(transform);

    var index = 0;
    var blink = story[index].point;
    // Draw the convex hull
    var featureHull =  svg.selectAll("path")
        .data(states)
        .enter()
        .append("path")
        .attr("class", function(d){return "group "+d.properties.id})
        

    var feature = g.selectAll("circle")
        .data(reps.features)
        .enter()
        .append("circle")
        .attr("class", "dot")
        .style("opacity", .9) 
        .style("fill", "red")
        .style("stroke","black")
        .attr("r", 6)

    var featureLabel = svg.selectAll(".place-label")
            .data(reps.features)
           
    var blinkRing = svg.selectAll("ring")
        .data(reps.features);

// Start the main process
    getHull();
    var blinkingID;
    var storyTransitionID;
    d3.select("#play")
      //.text("Play")
      .on("click",function(){
          var self = d3.select(this);
          if (playButton.state.nextState=="paused"){
            console.log(playButton.state.nextState);
            blinkingID = setInterval(transition, 300);
            storyTransitionID = setInterval(script, 3000);
          }else{
            console.log(playButton.state.nextState);
            clearInterval(storyTransitionID);
            clearInterval(blinkingID);
          }
          d3.select("text").text("Step:");
    });//end click function
    map.on("moveend", update);
    map.on('zoomend', update);
    update();

    function update() {
        featureHull.attr("d", path)

        feature.attr("transform", function(d) { 
            return "translate("+ 
                map.latLngToLayerPoint(d.LatLng).x +","+ 
                map.latLngToLayerPoint(d.LatLng).y +")";
        });

        featureLabel.filter(function(d,i){return i===blink;})
        .attr("transform", function(d) { 
            return "translate(" + 
                (map.latLngToLayerPoint(d.LatLng).x+10) +","+ 
                (map.latLngToLayerPoint(d.LatLng).y-10) +")";
        })
            //.attr("dy", ".35em")
            .text(function(d) { return "Next: "+d.properties.name; }); 
    }

    function script(){
        // Blinking point id
        blink = story[index].point;
        // Change the group
        reps.features[blink].properties.group = story[index].to;
        // Update the convex hull
        getHull()

        featureLabel.enter()
            .append("text")
            .attr("class", "place-label")
            .filter(function(d,i){return i===blink;})
            .attr("transform", function(d) { 
            return "translate(" + 
                (map.latLngToLayerPoint(d.LatLng).x) +","+ 
                (map.latLngToLayerPoint(d.LatLng).y-20) +")";
            })
            .attr("dy", ".35em")
            .text(function(d) {return d.properties.name; })
            .transition()
            .duration(3000)
            .remove();

        // draw hull
        featureHull.data(states)
        .transition()
            .delay(3000)
            .duration(1000)
            .attr("d", path)
        // update the story
        console.log(index)
        index = index==(story.length-1)?0:(index+1);
        update();
    }
    function transition(){
        blinkRing.enter()
        .append("circle")
        // Using filter to select a specific element
        .filter(function(d,i){return i===blink;})
            .attr("class", "ring")
            .attr("transform", function(d) { 
                return "translate("+ 
                    map.latLngToLayerPoint(d.LatLng).x +","+ 
                    map.latLngToLayerPoint(d.LatLng).y +")";})
            .attr("r", 6)
            .style("stroke-width", 1)
            .style("stroke", "red")
            .style("fill", "none")
        .transition()
            .ease(d3.easeLinear)
            .duration(1000) // Change Speed
            .style("stroke-opacity", 1e-6)
            .style("stroke-width", 3)
            .style("stroke", "red")
            .attr("r", 35)
            .remove();
    }
    function previous(){
      if(index>=2){
        index = index-2;
      }
      else{
        index = story.length-2
      }
      script();
      update();
    }
    function next(){

    }


</script>
</body>
</html>